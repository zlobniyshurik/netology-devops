Домашняя работа N12
===================

Задача 1
--------
*Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?*  
  
В Windows обычно это **ipconfig**:  
![ipconfig](/dz12/pic/dz12_1_1.png)
  
В линуксе вариантов больше:  
  
**ifconfig**  
![ifconfig](/dz12/pic/dz12_1_2.png)
  
**ip**  
![ip](/dz12/pic/dz12_1_3.png)
  
**networkctl**  
![networkctl](/dz12/pic/dz12_1_4.png)
  
и ещё пачка других вариантов.  

Задача 2
--------
*Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?*  
  
Нам нужен протокол **LLDP** (проприетарные неинтересны).  
Пакеты в разных дистрибутивах зовутся по разному, но обычно это **lldpd**  
  
Пример обнаружения соседей через **lldp**:  
```bash
[root@juggernaut etc]# lldpctl
-------------------------------------------------------------------------------
LLDP neighbors:
-------------------------------------------------------------------------------
Interface:    enp7s0, via: LLDP, RID: 1, Time: 0 day, 00:00:57
  Chassis:     
    ChassisID:    mac aa:bb:cc:dd:ee:ff
    SysName:      Zyxel
    SysDescr:     GS1900-8
    MgmtIP:       192.168.xxx.xxx
    Capability:   Bridge, on
  Port:        
    PortID:       local 3
    PortDescr:    First Comp
    TTL:          120
    PMD autoneg:  supported: yes, enabled: yes
      Adv:          10Base-T, HD: yes, FD: yes
      Adv:          100Base-TX, HD: yes, FD: yes
      Adv:          1000Base-T, HD: no, FD: yes
      MAU oper type: 1000BaseTFD - Four-pair Category 5 UTP, full duplex mode
  VLAN:         1, pvid: yes
  Unknown TLVs:
    TLV:          OUI: 00,A0,C5, SubType: 2, Len: 9 08,47,53,31,39,30,30,2D,38
    TLV:          OUI: 00,A0,C5, SubType: 3, Len: 27 1A,56,32,2E,36,30,28,41,41,48,48,2E,34,29,20,7C,20,30,35,2F,32,34,2F,32,30,32,31
    TLV:          OUI: 00,A0,C5, SubType: 4, Len: 18 11,43,38,2D,35,34,2D,34,42,2D,46,36,2D,37,32,2D,33,43
    TLV:          OUI: 00,A0,C5, SubType: 5, Len: 22 15,68,74,74,70,3A,2F,2F,31,39,32,2E,31,36,38,2E,31,2E,32,35,31,2F
    TLV:          OUI: 00,A0,C5, SubType: 7, Len: 9 08,4D,61,69,6E,42,61,73,65
-------------------------------------------------------------------------------
```

Задача 3
--------
*Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей?  
Какой пакет и команды есть в Linux для этого? Приведите пример конфига.*  
  
Для разбиения одной сети на несколько виртуальных используется технология VLAN'ов.  
  
Пакеты поддержки VLAN'ов для разных Linux-дистрибутивов называются по разному,  
в убунте это пакет **vlan**, а где-то и просто **vconfig**  
  
Пример конфига ***/etc/network/interfaces*** в убунте для 999го VLANа на интерфейсе eth1:  

```bash
auto eth1.999
iface eth1.999 inet static
        address 192.168.1.1
        netmask 255.255.255.0
        vlan_raw_device eth1
```

Задача 4
--------

*Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки?  
Приведите пример конфига.*  
  
Обычно используют два варианта агрегации - **bonding** и **teaming**. Второй,по идее, более современный и продвинутый,  
впрочем применение в данном конкретном случае зависит как от дистрибутива, так и от сетевых карт (точнее, драйверов для них),  
и, естественно, от наличия поддержки того или иного режима в оборудовании на другом конце линии.  
  
У бондинга есть, как минимум, следующие опции для балансировки нагрузки:  
  
**mode=0 (balance-rr)**  
Последовательно кидает пакеты, с первого по последний интерфейс.  
  
**mode=1 (active-backup)**  
Один из интерфейсов активен. Если активный интерфейс выходит из строя (link down и т.д.),  
другой интерфейс заменяет активный. Не требует дополнительной настройки коммутатора  
  
**mode=2 (balance-xor)**  
Передачи распределяются между интерфейсами на основе формулы  
**((MAC-адрес источника) XOR (MAC-адрес получателя)) % число интерфейсов**.  
Один и тот же интерфейс работает с определённым получателем. Режим даёт балансировку нагрузки и отказоустойчивость.  
  
**mode=3 (broadcast)**  
Все пакеты на все интерфейсы  
  
**mode=4 (802.3ad)**  
Link Agregation — IEEE 802.3ad, требует от коммутатора настройки.  
  
**mode=5 (balance-tlb)**  
Входящие пакеты принимаются только активным сетевым интерфейсом, исходящий распределяется  
в зависимости от текущей загрузки каждого интерфейса. Не требует настройки коммутатора.  
  
**mode=6 (balance-alb)**  
Тоже самое что 5, только входящий трафик тоже распределяется между интерфейсами. Не требует  
настройки коммутатора, но интерфейсы должны уметь изменять MAC.  
  
У тиминга примерно то же самое:  
  
**Automatic (Recommended)** — это не самостоятельный тип настройки. Этот тип выбирает между  
**Transmit Load Balancing (TLB)** или **802.3ad Dynamic**:  
  
Если все порты присоединены к коммутатору, который поддерживает IEEE 802.3ad LACP, и все порты установили связь  
с коммутатором по LACP, тогда будет выбран режим **802.3ad Dynamic**.  
  
Если коммутатор не поддерживает LACP или если один из портов в team, не установил связь с  
коммутатором по LACP, то будет выбран режим **TLB**.  
  
**Network Fault Tolerance Only (NFT)** — в режиме **NFT** от двух до восьми портов объединены вместе.  
Однако только один порт (primary port) используется для приема и передачи данных. Остальные порты  
находятся в режиме standby. Если основной порт выходит из строя, то другой порт заменяет его.  
Этот режим работает во всех остальных типах NIC teaming.  
  
**Network Fault Tolerance Only with Preference Order Network** — аналогичен типу **NFT**. Единственное  
отличие заключается в том, что этот тип позволяет административно назначить порядок в котором порты будут становиться основными.  
  
**Switch-assisted Load Balancing with Fault Tolerance (SLB)** — позволяет балансировать нагрузку для входящего  
и исходящего трафика. **SLB** работает только при условии, что коммутатор поддерживает какой-то вариант агрегирования  
портов (EtherChannel, MultiLink Trunking, статическое агрегирование без использования протоколов и др.).  
Этот вариант требует чтобы все сетевые интерфейсы сервера были подключены к одному коммутатору.  
  
**802.3ad Dynamic with Fault Tolerance** — идентичен типу **SLB**, но коммутатор должен поддерживать LACP.  
На портах коммутатора, к которым подключены сетевые интерфейсы сервера, должен быть включен LACP.  
  
**Transmit Load Balancing with Fault Tolerance (TLB)** — позволяет серверу балансировать исходящий трафик.  
TLB не зависит от коммутатора и позволяет портам в team быть подключенными к разным коммутаторам в одной и той же сети.  
Входящий трафик не балансируется. Основной (primary) порт в team отвечает за получение входящего трафика. В случае выхода  
из строя основного порта, механизм **NFT** отвечает за то что будет выбран другой порт на эту роль.  
  
**Transmit Load Balancing with Fault Tolerance and Preference Order** — аналогичен типу **TLB**. Единственное отличие  
заключается в том, что этот тип позволяет административно назначить порядок в котором порты будут становиться основными.  
  
Пример конфига **/etc/network/interfaces** для бондинга:  
```bash
auto bond0

iface bond0 inet static
    address 10.31.1.5
    netmask 255.255.255.0
    network 10.31.1.0
    gateway 10.31.1.254
    bond-slaves eth0 eth1
    bond-mode active-backup
    bond-miimon 100
    bond-downdelay 200
    bond-updelay 200
```

Задача 5
--------
