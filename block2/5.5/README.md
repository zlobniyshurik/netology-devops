# Домашнее задание к занятию "5.5. Оркестрация кластером Docker контейнеров на примере Docker Swarm"

## Как сдавать задания

*Обязательными к выполнению являются задачи без указания звездочки. Их выполнение необходимо для получения зачета и диплома о профессиональной переподготовке.*

*Задачи со звездочкой (\*) являются дополнительными задачами и/или задачами повышенной сложности. Они не являются обязательными к выполнению, но помогут вам глубже понять тему.*

*Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.*

*Любые вопросы по решению задач задавайте в чате учебной группы.*

---

## Задача 1

*Дайте письменые ответы на следующие вопросы:*

- *В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?*
- *Какой алгоритм выбора лидера используется в Docker Swarm кластере?*
- *Что такое Overlay Network?*

----

**В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?**  
+ При **replication** режиме по нодам раскидывается ровно то количество копий сервиса, что указано в количестве реплик (а вот как их раскидает - зависит от настроек и доступных ресурсов в кластере).  

+ При **global** режиме на все доступные ноды попадает по одной копии сервиса.

----

**Какой алгоритм выбора лидера используется в Docker Swarm кластере?**  
Алгоритм **Raft**

----

**Что такое Overlay Network?**  
**Overlay Network** - распределённая виртуальная сеть между хостами с docker'ом. Живёт поверх реальных сетей, подключенных к конкретным докер-нодам. Служит для прозрачного и безопасного обмена данными и управляющими командами между докер-контейнерами кластера. Маршрутизация данных автоматическая (конечному пользователю с ней заморачиваться не нужно).

## Задача 2

*Создать ваш первый Docker Swarm кластер в Яндекс.Облаке*

*Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:*
```
docker node ls
```

Сделано, с третьей попытки, но заработало...  
![список нод docker swarm'а](./pic/dz55_2.png)

## Задача 3

*Создать ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.*

*Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:*
```
docker service ls
```

Работает...  
![список сервисов кластера](./pic/dz55_3.png)

...и даже красивые картинки рисует  
![Grafana на кластере](./pic/dz55_extra.png)

## Задача 4 (*)

*Выполнить на лидере Docker Swarm кластера команду (указанную ниже) и дать письменное описание её функционала, что она делает и зачем она нужна:*
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```

Включил, испугался, полез читать документацию...  
![включение автоблокировки роя](./pic/dz55_4.png)

Если я правильно понял, то ключ **--autolock=true** предназначен для включения режима автоблокировки роя.

В этом режиме вся информация из Raft-логов менеджерских нод шифруется ключом, без знания которого невозможно войти в число менеджерских нод и похитить TLS-ключи, используемые для обмена данными между нодами.

Соответственно, после перезагрузки/переподключения любой из менеджерских нод, необходимо на этой самой ноде ввести ключ шифрования, иначе не быть больше ноде менеджером.
