# Домашнее задание к занятию "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."


## Как сдавать задания

Обязательными к выполнению являются задачи без указания звездочки. Их выполнение необходимо для получения зачета и диплома о профессиональной переподготовке.

Задачи со звездочкой (*) являются дополнительными задачами и/или задачами повышенной сложности. Они не являются обязательными к выполнению, но помогут вам глубже понять тему.

Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

## Задача 1

*Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.*

**Полная виртуализация:**  
В гостевой ОС виртуализуется абсолютно всё - память, диски, сеть и даже процессор.  

Бонусы: По идее, мы даже не привязаны к архитектуре процессора, можем эмулировать любую, лишь бы вычислительных ресурсов хватило.  

Минусы: На практике сложна в реализации и требует значительных побочных расходов вычислительных ресурсов, если, конечно не перевести часть операций по виртуализации на плечи аппаратной части платформы.

**Аппаратная виртуализация:**  
Комплекс аппаратных решений, упрощающих и ускоряющих реализацию полной виртуализации в системе.

Как пример, технологии ***Intel VT-x*** и ***AMD-V***, позволяющие организовать для гипервизора работу в кольце сверхвысоких привилегий процессора (**Ring -1**), что, в свою очередь, позволяет отдать гостевой ОС так необходимое ей для нормальной работы кольцо высоких привилегий (**Ring 0**).

**Паравиртуализация:**  
Основная идея - гостевая ОС в курсе о том, что запущена в виртуальной среде. Благодаря этому, она может запросить те или иные ресурсы у хостовой ОС через стандартные API, что в свою очередь, при грамотной реализации существенно повышает быстродействие виртуализуемых ОС и снижает накладные расходы.

Бонусы: При грамотной реализации скорость виртуальных ОС относительно работы на "честном" железе падает крайне незначительно (единицы процентов).

Минусы: Гостевая ОС должна предусматривать возможность запуска в режиме паравиртуализации. К счастью, практически все современные ОС удовлетворяют этому условию.

**Виртуализация на основе ОС:**  
Недовиртуализация. Виртуализация происходит не на уровне железа, а на уровне приложения. ОС одна, виртуализованных приложений много и они друг-друга не видят.

Бонусы: Минимум накладных расходов.

Минусы:  
1. Меньшая безопасность. Случись что с ОС, прилетит всем приложениям.
2. Невозможность индивидуально настроить ОС (версия ядра, наличие заплаток, e.t.c.) под нужды каждого конкретного приложения

## Задача 2

*Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.*

*Организация серверов:*
- *физические сервера,*
- *паравиртуализация,*
- *виртуализация уровня ОС.*

*Условия использования:*
- *Высоконагруженная база данных, чувствительная к отказу.*
- *Различные web-приложения.*
- *Windows системы для использования бухгалтерским отделом.*
- *Системы, выполняющие высокопроизводительные расчеты на GPU.*

*Опишите, почему вы выбрали к каждому целевому использованию такую организацию.*

**Высоконагруженная база данных, чувствительная к отказу:** 

Не спец, но мне кажется, что кластер из нескольких физических серверов обеспечил бы максимальную производительность и относительную устойчивость к сбоям.  

Но, в принципе, можно и по экземпляру БД запихнуть в (пара)виртуалки, однако придётся пошевелить мозгами, оптимально распределив виртуалки между хост-машинами (типа, по одной виртуалке с БД на хост, да с выделенными каждой из этих виртуалок в эксклюзивное пользование дисками).  

Но, вообще, тут, по идее, смотреть надо - во что упирается производительность БД (диски, сеть, память, ядра процессора). И как у нас с этими ресурсами на виртуалках дела обстоят.

**Различные web-приложения:**

А вот здесь можно и виртуализацию уровня ОС, запуская по мере роста нагрузки всё больше одинаковых экземпляров web-приложений.

**Windows системы для использования бухгалтерским отделом.:**  

Мегаскорость здесь не нужна, а вот возможность бэкапа всего софта с настройками одним махом очень даже актуальна. Imho, в этом случае лучше всего подойдёт паравиртуализация типа VBox`а, главное, чтобы не было проблем с пробросом USB-портов в виртуалку для работы с многочисленными USB-токенами.

**Системы, выполняющие высокопроизводительные расчеты на GPU.**  

Сильно зависит от применяемого железа. Можно и физическими серверами обойтись, а можно и о паравиртуализации подумать. 

Если у виртуалки нет проблем с пробросом PCIe портов к конкретному GPU (и биос+мать это позволяют), если драйвера GPU не требуют 100500 денег за возможность работы GPU с виртуалками, то, по идее, пачкой независимых виртуалок (с одним-двумя GPU на каждую) управлять удобней. Хотя скорость немного упадёт, но, вроде как, это единицы процентов. Осталось решить - стоит ли овчинка выделки?

Но, возможно, я и не прав - с обработкой данных на GPU лично не сталкивался.

## Задача 3

*Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.*

*Сценарии:*

1. *100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.*

По идее, проще всего использовать Hyper-V - windows-админы у нас уже есть, балансировку нагрузки Hyper-V умеет, с репликацией данных и резервными копиями проблем тоже не предвидится.

2. *Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.*

Да здесь и вариантов-то особо нет - только KVM, всё остальное - ересь! :)

3. *Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.*

Пожалуй, Hyper-V - совместимость выше всяких похвал, как по софту, так и по железу, да и официально бесплатен.

4. *Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.*

Не понял вопрос - нам надо на одном хосте несколько разных линуксов сымитировать? 

Если да, то от операционки на хосте зависит, но проще всего какой-нибудь VirtualBox развернуть - он наиболее универсален и понятен конечному пользователю. А в VBox'е уже виртуалки с соответствующими дистрибутивами линукса.

## Задача 4

*Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.*

Главные проблемы:  
+ Мы получаем несколько несовместимых друг с другом систем и хостов виртуализации. Случись что, быстро и бесшовно перегнать виртуалку, скажем, с хоста на Hyper-V на хост с KVMом не получится.

+ Каждую из систем придётся настраивать отдельно - бекапы, мониторинг, e.t.c.

+ На каждую из систем требуется грамотный персонал, имеющий достойные навыки борьбы с данной конкретной системой виртуализации.

Моё мнение - сильно зависит от конкретной ситуации.  Но, даже если у меня и не было бы проблем с грамотным персоналом, я бы, если и согласился на гетерогенную среду, то с расчётом на её постепенный перевод в гомогенное состояние. Условно, KVM + Hyper-V с постепенным переходом только на KVM - "окошки", как серверные системы, уходят в прошлое (туда им и дорога).

